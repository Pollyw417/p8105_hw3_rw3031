---
title: "hw3_rw3031"
author: "Polly Wu (rw3031)"
date: "2024-10-05"
output: github_document
---

## library and visual theme set up

```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)
library(patchwork)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal()+theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_color_viridis_d
```

# Problem 1 

load the NY NOAA dataset
```{r}
library(p8105.datasets)
data("ny_noaa")
```

### explore the NY NOAA dataset

```{r}
nrow(ny_noaa)
ncol(ny_noaa)
summary(ny_noaa)

ny_noaa |> 
  ggplot(aes(x = prcp)) + 
  geom_histogram()

ny_noaa |> 
  ggplot(aes(x = snow)) + 
  geom_histogram()

ny_noaa |> 
  ggplot(aes(x = snwd)) + 
  geom_histogram()
```
There are 2595176 observations and 7 variables (id, date, prcp, snow, snwd, 
tmax, tmin) in dataset. The variable tmax and tmin are imported as character variable.

The earliest date for the data is 1981-01-01 and the most recent date is 2012-12-31.

Precipitation ranges from 0 to 22860 (tenths of mm) and 145838 observations do not 
report precipitation data. Snowfall range from -13 mm to 10160 mm, and 381221 
observations' data on snowfall is missing, Snow depth range from 0 to 9195 mmm 
and 591786 observations do not have snow depth data. All three variables are highly
right skewed since there are a lot of days that there is no rain or snow

```{r}
ny_noaa = 
  ny_noaa|>
  mutate(
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin))

summary(ny_noaa)
```

I change the character variable tmax and tmin into numeric instead. 

There are more than 1100,000 observations that have the maximum and minimum temperature 
missing within the dataset which is more than 40% of the observations. 

### cleaning the NY_NOAA data 

Create separate variables for year, month, and day. 
```{r}
ny_noaa=
ny_noaa|>
  mutate(year = year(date),
         month = month(date),
         day = day(date))
```

```{r}
ny_noaa |> 
  ggplot(aes(x = snow)) + 
  geom_histogram()
```
For snowfall the most commonly observed value is 0 since except for cold winter time
there is not any snow. 

### average temperatue in January and July

```{r}
ny_noaa|>
  filter(month ==1 | month == 7)|>
  group_by(year,month)|>
  summarize(avg_tmax = mean(tmax, na.rm = TRUE))|>
  ggplot(aes(x = year, y=avg_tmax))+
  geom_point()+geom_line()+
  facet_grid(.~month)
```

The average maximum temperature in January and July fluctuates a lot. The years with higher tmax in January tend to have higher tmax in July as well. 

### tmax and tmin and distribution of snowfall

```{r}
tmax_tmin_p=
ny_noaa|>
  ggplot(aes(x= tmax, y=tmin))+
  geom_bin2d()+
  theme(legend.position = "right")

snow_p=
ny_noaa|>
  filter(snow>0, snow<100)|>
  group_by(year)|>
  ggplot(aes(x=snow))+
  geom_histogram()

tmax_tmin_p + snow_p
```

# Problem 2 

### import the datasets 

#### tidy up and filter demographic data

```{r}
demo =
  read_csv(file = "./nhanes_covar.csv", 
           skip = 4, na = c(".", "NA", ""))|>
  janitor::clean_names()|>
  filter(age >=21)|>
  drop_na()|>
  mutate(sex = as.factor(ifelse(sex == 2, "Female", "Male")),
         education = as.factor(case_when(
           education == 1 ~ "Less than high school",
           education == 2 ~ "High school equivalent",
           education == 3 ~ "More than high school", 
           TRUE ~ NA
         )))
```

#### import the accel data and merge

```{r}
accel =
  read_csv(file = "./nhanes_accel.csv", na = c(".", "NA", ""))|>
  janitor::clean_names()

nhanes = 
  left_join(demo,accel, by="seqn")
```
### the number of men and women in each education category

```{r}
nhanes|>
  group_by(education)|>
  count(sex)|>
  pivot_wider(
    values_from = n,
    names_from = sex
  )
```
23 women and 35 men in the study have high school equivalent education. 28 women and 
27 men in the study have less than high school education. 59 women and 56 men in the 
study have more than high school education. 

### age distributions for men and women in each education category

```{r}
nhanes|>
  ggplot(aes(x=age))+
  geom_boxplot()+
  facet_grid(sex ~ education)
```
The mean for age within the group with high school equivalent education is higher 
in female compared to male, as well as the first and third quartile. The distribution
for age within the group with less than high school education is quite equivalent 
across different sex group. The first and third quartile of the age distribution for female and male in the group with more than high school education is similar while the 
mean for the female group is smaller. 

### total daily activity

```{r}
nhanes|>
  pivot_longer(
    min1:min1440,
    names_to = "mim_min",
    names_prefix = "min",
    values_to = "mims_value"
  )|>
  group_by(seqn, sex, age, education)|>
  summarize(total=sum(mims_value))|>
  ggplot(aes(x=age, y=total, color = sex))+
  geom_point()+geom_smooth()+
  facet_grid(~education)
```
In the group with less than high school education, the level of physical activity 
decrease signficantly as age increases. Female in this group is more active than man before 40 in this group. For the group with high school equivalent education, the level of physical activity peaks at the age of 40, and female is in general more active than man across all age. In the group with more than high school education, both men and women's level of physical activity decrease only slightly overtime, and female is in general more active than male. 


# Problem 3 

## import the datasets
```{r}
jan2020 =
  read_csv(file = "./citibike/Jan 2020 Citi.csv", na = c(".", "NA", ""))|>
  janitor::clean_names()|>
  mutate(
    year = 2020,
    month = "January"
  )

jan2024 =
  read_csv(file = "./citibike/Jan 2024 Citi.csv", na = c(".", "NA", ""))|>
  janitor::clean_names()|>
  mutate(
    year = 2024,
    month = "January"
  )

july2020 =
  read_csv(file = "./citibike/July 2020 Citi.csv", na = c(".", "NA", ""))|>
  janitor::clean_names()|>
  mutate(
    year = 2020,
    month = "July"
  )

july2024 =
  read_csv(file = "./citibike/July 2024 Citi.csv", na = c(".", "NA", ""))|>
  janitor::clean_names()|>
  mutate(
    year = 2024,
    month = "July"
  )

citibike = 
  bind_rows(jan2020,july2020,jan2024,july2024)|>
  relocate(ride_id, year,month, weekdays)
```
The citibike dataset has the following variables: `r names(citibike)`.
There are a total of `r nrow(citibike)` observations and `r ncol(citibike)` variables.
